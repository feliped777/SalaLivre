<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visão - Salas Cirúrgicas</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="page-visao">

    <header class="header-status">
        <h1 class="titulo-pagina">Visão - Salas Cirúrgicas</h1>
    </header>

    <div class="container-visao">
        <aside class="legenda">
            <div class="logo-status-container" style="justify-content: center; padding-bottom: 40px;">
                <img src="logo.png" alt="Logo HGF" class="logo-status">
            </div>
            
            <div class="item-legenda">
                <span class="circulo disponivel"></span> Disponível
            </div>
            <div class="item-legenda">
                <span class="circulo retirada"></span> Retirada
            </div>
            <div class="item-legenda">
                <span class="circulo limpeza"></span> Limpeza
            </div>
            <div class="item-legenda">
                <span class="circulo ocupada"></span> Ocupada
            </div>
            <div class="item-legenda">
                <span class="circulo indisponivel"></span> Indisponível
            </div>
        </aside>

        <main class="grid-colmeia">
            <div class="hex-row">
                <div id="sala-2" class="hexagon"><span>Sala 2</span></div>
                <div id="sala-4" class="hexagon"><span>Sala 4</span></div>
                <div id="sala-6" class="hexagon"><span>Sala 6</span></div>
                <div id="sala-8" class="hexagon"><span>Sala 8</span></div>
            </div>
            <div class="hex-row offset">
                <div id="sala-1" class="hexagon"><span>Sala 1</span></div>
                <div id="sala-3" class="hexagon"><span>Sala 3</span></div>
                <div id="sala-5" class="hexagon"><span>Sala 5</span></div>
                <div id="sala-7" class="hexagon"><span>Sala 7</span></div>
            </div>
            <div class="hex-row">
                <div id="sala-10" class="hexagon"><span>Sala 10</span></div>
                <div id="sala-12" class="hexagon"><span>Sala 12</span></div>
                <div id="sala-14" class="hexagon"><span>Sala 14</span></div>
                <div id="sala-16" class="hexagon"><span>Sala 16</span></div>
            </div>
            <div class="hex-row offset">
                <div id="sala-9" class="hexagon"><span>Sala 9</span></div>
                <div id="sala-11" class="hexagon"><span>Sala 11</span></div>
                <div id="sala-13" class="hexagon"><span>Sala 13</span></div>
                <div id="sala-15" class="hexagon"><span>Sala 15</span></div>
            </div>
        </main>
    </div>

    <script type="module">
    // 1. IMPORTAÇÃO FIREBASE
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    // Suas credenciais reais (as mesmas usadas nas salas)
    const firebaseConfig = {
        apiKey: "AIzaSyA_H-Ilb_bXEf uL6aNyLu3cvUBe9G_3RKY",
        authDomain: "salalivre-51288.firebaseapp.com",
        projectId: "salalivre-51288",
        storageBucket: "salalivre-51288.firebasestorage.app",
        messagingSenderId: "307835751640",
        appId: "1:307835751640:web:715796b42b827e7f9a0c7b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- FUNÇÃO PARA ATUALIZAR O HEXÁGONO ---
    function aplicarStatusHexagono(salaNum, status) {
        const hexElemento = document.getElementById(`sala-${salaNum}`);
        if (hexElemento) {
            // Remove todas as classes de cor possíveis
            hexElemento.classList.remove('disponivel', 'retirada', 'limpeza', 'ocupada', 'indisponivel');
            
            // Adiciona a classe que veio do Firebase (ou 'indisponivel' por padrão)
            const classeFinal = status || 'indisponivel';
            hexElemento.classList.add(classeFinal);
        }
    }

    // --- MÁGICA DA ATUALIZAÇÃO EM TEMPO REAL ---
    // Em vez de setInterval ou eventListener 'storage', usamos o onValue do Firebase
    const statusRef = ref(db, 'status_atual');

    onValue(statusRef, (snapshot) => {
        const dadosSalas = snapshot.val();
        
        console.log("Dados recebidos da nuvem:", dadosSalas);

        // Se não houver dados no banco ainda
        if (!dadosSalas) {
            // Define todas como indisponível por padrão
            for (let i = 1; i <= 16; i++) {
                aplicarStatusHexagono(i, 'indisponivel');
            }
            return;
        }

        // Percorre as 16 salas
        for (let i = 1; i <= 16; i++) {
            const salaData = dadosSalas[`sala${i}`];
            if (salaData) {
                aplicarStatusHexagono(i, salaData.status);
            } else {
                aplicarStatusHexagono(i, 'indisponivel');
            }
        }
    });

</script>
</body>
</html>